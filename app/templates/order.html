{% extends "base.html" %}
{% block title %}ุทูุจ ูุทุน ุบูุงุฑ - Parts Hunter{% endblock %}

{% block content %}
<div class="order-container">
  <h3 class="text-center mb-4">ุทูุจ ูุทุน ุบูุงุฑ</h3>

  <!-- ุงูุชุจููุจุงุช -->
  <div class="tabs">
    <button class="tab-button active" onclick="switchTab('car')">๐ ุณูุงุฑุฉ</button>
    <button class="tab-button" onclick="switchTab('truck')">๐ ุดุงุญูุฉ</button>
    <button class="tab-button" onclick="switchTab('bike')">๐๏ธ ููุชุฑ</button>
    <button class="tab-button" onclick="switchTab('gen')">โก ูููุฏ</button>
    <button class="tab-button" onclick="switchTab('elec')">๐ ููุฑุจุงุฆูุงุช</button>
  </div>

  <form id="orderForm">
    <input type="text" name="name" placeholder="ุงูุงุณู" required />
    <input type="text" name="phone" placeholder="ุฑูู ุงููุงุชู ุฃู ูุงุชุณุงุจ" required />

    <!-- ุณูุงุฑุงุช -->
    <div id="car" class="form-section active">
      <label>ุจุฑุงูุฏ ุงููุฑูุจุฉ:</label>
      <select name="car_brand" onchange="updateModels('car')">
        <option value="">ุงุฎุชุฑ ุงูุจุฑุงูุฏ</option>
      </select>

      <label>ููุฏูู ุงููุฑูุจุฉ:</label>
      <select name="car_model" onchange="checkOtherModel('car')">
        <option value="">ุงุฎุชุฑ ุงูููุฏูู</option>
      </select>
      <input type="text" name="car_model_other" placeholder="ุงูุชุจ ููุฏูู ุขุฎุฑ" style="display:none;" />

      <label>ุณูุฉ ุงูุตูุน:</label>
      <select name="car_year"></select>

      <label>ููุน ุงููุญุฑู:</label>
      <div class="engine-type">
        <label><input type="radio" name="car_engine_type" value="ุงุญุชุฑุงู" checked onchange="toggleFuel(this.value, 'car')" /> ุงุญุชุฑุงู ุฏุงุฎูู</label>
        <label><input type="radio" name="car_engine_type" value="ููุฑุจุงุฆู" onchange="toggleFuel(this.value, 'car')" /> ููุฑุจุงุฆู</label>
      </div>

      <div id="car_fuelField">
        <label>ููุน ุงููููุฏ:</label>
        <select name="car_fuel">
          <option>ุจูุฒูู</option>
          <option>ุฌุงุฒูููู</option>
        </select>
      </div>

      <input type="text" name="car_serial" placeholder="ุฑูู ุงูุดุงุณูู (ุฅู ูุฌุฏ)" />
    </div>

    <!-- ุดุงุญูุงุช -->
    <div id="truck" class="form-section">
      <label>ุจุฑุงูุฏ ุงูุดุงุญูุฉ:</label>
      <select name="truck_brand" onchange="updateModels('truck')">
        <option value="">ุงุฎุชุฑ ุงูุจุฑุงูุฏ</option>
      </select>

      <label>ููุฏูู ุงูุดุงุญูุฉ:</label>
      <select name="truck_model" onchange="checkOtherModel('truck')">
        <option value="">ุงุฎุชุฑ ุงูููุฏูู</option>
      </select>
      <input type="text" name="truck_model_other" placeholder="ุงูุชุจ ููุฏูู ุขุฎุฑ" style="display:none;" />

      <label>ุณูุฉ ุงูุตูุน:</label>
      <select name="truck_year"></select>

      <label>ููุน ุงููุญุฑู:</label>
      <div class="engine-type">
        <label><input type="radio" name="truck_engine_type" value="ุงุญุชุฑุงู" checked onchange="toggleFuel(this.value, 'truck')" /> ุงุญุชุฑุงู ุฏุงุฎูู</label>
        <label><input type="radio" name="truck_engine_type" value="ููุฑุจุงุฆู" onchange="toggleFuel(this.value, 'truck')" /> ููุฑุจุงุฆู</label>
      </div>

      <div id="truck_fuelField">
        <label>ููุน ุงููููุฏ:</label>
        <select name="truck_fuel">
          <option>ุฏูุฒู</option>
          <option>ุจูุฒูู</option>
        </select>
      </div>

      <input type="text" name="truck_serial" placeholder="ุฑูู ุงูุดุงุณูู (ุฅู ูุฌุฏ)" />
    </div>

    <!-- ููุชูุฑุงุช -->
    <div id="bike" class="form-section">
      <label>ุจุฑุงูุฏ ุงูููุชูุฑ:</label>
      <select name="bike_brand" onchange="updateModels('bike')">
        <option value="">ุงุฎุชุฑ ุงูุจุฑุงูุฏ</option>
      </select>

      <label>ููุฏูู ุงูููุชูุฑ:</label>
      <select name="bike_model" onchange="checkOtherModel('bike')">
        <option value="">ุงุฎุชุฑ ุงูููุฏูู</option>
      </select>
      <input type="text" name="bike_model_other" placeholder="ุงูุชุจ ููุฏูู ุขุฎุฑ" style="display:none;" />

      <label>ุณูุฉ ุงูุตูุน:</label>
      <select name="bike_year"></select>

      <label>ููุน ุงููุญุฑู:</label>
      <div class="engine-type">
        <label><input type="radio" name="bike_engine_type" value="ุงุญุชุฑุงู" checked onchange="toggleFuel(this.value, 'bike')" /> ุงุญุชุฑุงู ุฏุงุฎูู</label>
        <label><input type="radio" name="bike_engine_type" value="ููุฑุจุงุฆู" onchange="toggleFuel(this.value, 'bike')" /> ููุฑุจุงุฆู</label>
      </div>

      <div id="bike_fuelField">
        <label>ููุน ุงููููุฏ:</label>
        <select name="bike_fuel">
          <option>ุจูุฒูู</option>
          <option>ุฌุงุฒูููู</option>
        </select>
      </div>

      <input type="text" name="bike_serial" placeholder="ุฑูู ุงูุดุงุณูู (ุฅู ูุฌุฏ)" />
    </div>

    <!-- ูููุฏ -->
    <div id="gen" class="form-section">
      <label>ููุน ุงููููุฏ:</label>
      <select name="gen_type">
        <option>ุจูุฑููุฒ</option>
        <option>ูุงุชุฑุจููุฑ</option>
        <option>ููุจูุชุง</option>
        <option>ูุงููุงุฑ</option>
        <option>ูููุฏุง</option>
        <option>ูุงูุงูุง</option>
        <option>ุฃุฎุฑู</option>
      </select>

      <input type="text" name="gen_capacity" placeholder="ุงูุณุนุฉ ุจุงููููู ูููุช" />
      <input type="text" name="gen_fuel" placeholder="ููุน ุงููููุฏ" />
      <input type="text" name="gen_serial" placeholder="ุงูุณูุฑูุงู ููุจุฑ (ุฅู ูุฌุฏ)" />
    </div>

    <!-- ููุฑุจุงุฆูุงุช -->
    <div id="elec" class="form-section">
      <label>ููุน ุงููุทุนุฉ ุงูููุฑุจุงุฆูุฉ:</label>
      <select name="elec_type">
        <option>ุซูุงุฌุฉ</option>
        <option>ุบุณุงูุฉ</option>
        <option>ุจูุชูุฌุงุฒ</option>
        <option>ูููู</option>
        <option>ูุงููุฑููู</option>
        <option>ุฃุฎุฑู</option>
      </select>

      <input type="text" name="elec_brand" placeholder="ุงูููุงุตูุงุช ุฃู ุงูุจุฑุงูุฏ" />
    </div>

    <textarea name="description" rows="3" placeholder="ูุตู ุงููุทุนุฉ ุงููุทููุจุฉ" required></textarea>

    <div class="form-buttons">
      <button type="reset">ูุณุญ</button>
      <button type="button" onclick="sendToWhatsApp('971566672873')">ุฅุฑุณุงู</button>
    </div>
  </form>
</div>

<script>
  // ุจูุงูุงุช ุงูุจุฑุงูุฏุงุช ูุงูููุฏููุงุช
  const data = {
    car: {
      brands: {
        "ุชูููุชุง": ["ููุฑููุง", "ูุงูุฑู", "ูุงูุฏูุฑูุฒุฑ", "ูุงููููุณ"],
        "ููุณุงู": ["ุจุงุชุฑูู", "ุชูุงูุง", "ูุงูุงุฑุง"],
        "ูููุฏุงู": ["ุณููุงุชุง", "ุฃูุณูุช", "ุชูุณุงู"],
        "ููุง": ["ุณุจูุฑุชุงุฌ", "ุฑูู", "ุณูุฑุงุชู"],
        "ููุฑุฏ": ["ุฑูุฌูุฑ", "ุฅูุณุจููุฑุฑ", "ูููุฌู"],
        "ุดููุฑูููู": ["ูุงููุจู", "ูุงูุงุฑู", "ุณููุงุฏูุฑ"],
        "ููุชุณูุจูุดู": ["ูุงูุณุฑ", "ุฃูุชูุงูุฏุฑ", "ุจุงุฌูุฑู"],
        "ุฃุฎุฑู": []
      }
    },
    truck: {
      brands: {
        "ุฅูุณูุฒู": ["NPR", "FVR", "Giga"],
        "ููููุฏุงู": ["HD65", "HD72", "HD78"],
        "ูุฑุณูุฏุณ": ["ุฃูุชุฑูุณ", "ุฃูุณูุฑ", "ุฃุชุบู"],
        "ูุงู": ["TGS", "TGX", "TGM"],
        "ููููู": ["FM", "FH", "FL"],
        "ุณูุงูููุง": ["R-Series", "S-Series", "P-Series"],
        "ุฃุฎุฑู": []
      }
    },
    bike: {
      brands: {
        "ูุงูุงูุง": ["YZF-R15", "MT-15", "FZ"],
        "ูููุฏุง": ["CBR150R", "CBR250R", "CRF"],
        "ุณูุฒููู": ["GSX-R150", "GSX-S150", "V-Strom"],
        "ููุงุฒุงูู": ["Ninja 250", "Z250", "Versys"],
        "ุฃุฎุฑู": []
      }
    }
  };

  // ููุก ุงูุณููุงุช
  const years = [];
  for(let y=1960; y<=2026; y++) years.push(y);

  ["car_year", "truck_year", "bike_year"].forEach(name=>{
    const select = document.getElementsByName(name)[0];
    years.forEach(year=>{
      const opt = document.createElement("option");
      opt.value = year;
      opt.textContent = year;
      select.appendChild(opt);
    });
  });

  // ููุก ุงูุจุฑุงูุฏุงุช
  ["car", "truck", "bike"].forEach(section=>{
    const brandSelect = document.getElementsByName(section + "_brand")[0];
    const brands = Object.keys(data[section].brands);
    brands.forEach(b=>{
      const opt = document.createElement("option");
      opt.value = b;
      opt.textContent = b;
      brandSelect.appendChild(opt);
    });
  });

  // ุชุญุฏูุซ ุงูููุฏููุงุช ุนูุฏ ุงุฎุชูุงุฑ ุงูุจุฑุงูุฏ
  function updateModels(section){
    const brandSelect = document.getElementsByName(section + "_brand")[0];
    const modelSelect = document.getElementsByName(section + "_model")[0];
    const otherInput = document.getElementsByName(section + "_model_other")[0];
    const selectedBrand = brandSelect.value;

    modelSelect.innerHTML = '<option value="">ุงุฎุชุฑ ุงูููุฏูู</option>';

    if(selectedBrand && data[section].brands[selectedBrand]){
      data[section].brands[selectedBrand].forEach(model=>{
        const opt = document.createElement("option");
        opt.value = model;
        opt.textContent = model;
        modelSelect.appendChild(opt);
      });
    }

    // ุฅุถุงูุฉ ุฎูุงุฑ "ุฃุฎุฑู"
    const otherOpt = document.createElement("option");
    otherOpt.value = "ุฃุฎุฑู";
    otherOpt.textContent = "ุฃุฎุฑู";
    modelSelect.appendChild(otherOpt);

    otherInput.style.display = "none";
    otherInput.value = "";
  }

  // ุงุธูุงุฑ ุญูู ูุชุงุจุฉ ููุฏูู ุฃุฎุฑู ุนูุฏ ุงูุงุฎุชูุงุฑ
  function checkOtherModel(section){
    const modelSelect = document.getElementsByName(section + "_model")[0];
    const otherInput = document.getElementsByName(section + "_model_other")[0];
    if(modelSelect.value === "ุฃุฎุฑู"){
      otherInput.style.display = "block";
      otherInput.focus();
    } else {
      otherInput.style.display = "none";
      otherInput.value = "";
    }
  }

  // ุฅุธูุงุฑ/ุฅุฎูุงุก ููุน ุงููููุฏ ุญุณุจ ููุน ุงููุญุฑู
  function toggleFuel(value, tab) {
    const fuelField = document.getElementById(tab + "_fuelField");
    if(fuelField){
      fuelField.style.display = (value === "ุงุญุชุฑุงู") ? "block" : "none";
    }
  }

  // ุชุจุฏูู ุงูุชุจููุจุงุช
  function switchTab(tabId) {
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.form-section').forEach(sec => sec.classList.remove('active'));
    document.querySelector(`button[onclick="switchTab('${tabId}')"]`).classList.add('active');
    document.getElementById(tabId).classList.add('active');
  }

  // ุฅุฑุณุงู ุงูุจูุงูุงุช ุนุจุฑ ูุงุชุณุงุจ
  function sendToWhatsApp(number){
    const form = document.getElementById('orderForm');
    const name = form.name.value.trim();
    const phone = form.phone.value.trim();
    const description = form.description.value.trim();

    if(!name || !phone || !description){
      alert("ูุฑุฌู ููุก ุงูุญููู ุงูุฃุณุงุณูุฉ: ุงูุงุณูุ ุฑูู ุงููุงุชูุ ููุตู ุงููุทุนุฉ.");
      return;
    }

    let message = `*ุทูุจ ุฌุฏูุฏ ูู ูููุน Parts Hunter*%0A๐ค ุงูุงุณู: ${encodeURIComponent(name)}%0A๐ ุงููุงุชู: ${encodeURIComponent(phone)}%0A๐ ูุตู ุงููุทุนุฉ: ${encodeURIComponent(description)}`;

    const sections = ["car", "truck", "bike", "gen", "elec"];
    let activeSection = null;
    for(const s of sections){
      if(document.getElementById(s).classList.contains("active")){
        activeSection = s;
        break;
      }
    }

    if(["car", "truck", "bike"].includes(activeSection)){
      const brand = form[activeSection + "_brand"].value;
      let model = form[activeSection + "_model"].value;
      const modelOther = form[activeSection + "_model_other"].value.trim();
      const year = form[activeSection + "_year"].value;
      const engine = form[activeSection + "_engine_type"].value;
      const fuel = form[activeSection + "_fuel"]?.value || "";
      const serial = form[activeSection + "_serial"].value.trim();

      if(model === "ุฃุฎุฑู" && modelOther){
        model = modelOther;
      }

      message += `%0A๐ ุจุฑุงูุฏ ุงููุฑูุจุฉ: ${encodeURIComponent(brand)}`;
      message += `%0A๐ ุงูููุฏูู: ${encodeURIComponent(model)}`;
      message += `%0A๐ ุณูุฉ ุงูุตูุน: ${encodeURIComponent(year)}`;
      message += `%0A๐ง ููุน ุงููุญุฑู: ${encodeURIComponent(engine)}`;
      if(engine === "ุงุญุชุฑุงู"){
        message += `%0Aโฝ ููุน ุงููููุฏ: ${encodeURIComponent(fuel)}`;
      }
      message += `%0A๐ข ุฑูู ุงูุดุงุณูู: ${encodeURIComponent(serial)}`;

    } else if(activeSection === "gen"){
      const genType = form.gen_type.value;
      const genCapacity = form.gen_capacity.value.trim();
      const genFuel = form.gen_fuel.value.trim();
      const genSerial = form.gen_serial.value.trim();

      message += `%0Aโก ููุน ุงููููุฏ: ${encodeURIComponent(genType)}`;
      message += `%0A๐ ุงูุณุนุฉ: ${encodeURIComponent(genCapacity)}`;
      message += `%0Aโฝ ููุน ุงููููุฏ: ${encodeURIComponent(genFuel)}`;
      message += `%0A๐ข ุงูุณูุฑูุงู ููุจุฑ: ${encodeURIComponent(genSerial)}`;

    } else if(activeSection === "elec"){
      const elecType = form.elec_type.value;
      const elecBrand = form.elec_brand.value.trim();

      message += `%0A๐ ููุน ุงููุทุนุฉ ุงูููุฑุจุงุฆูุฉ: ${encodeURIComponent(elecType)}`;
      message += `%0Aโ๏ธ ุงูููุงุตูุงุช ุฃู ุงูุจุฑุงูุฏ: ${encodeURIComponent(elecBrand)}`;
    }

    const waUrl = `https://wa.me/${number}?text=${message}`;
    window.open(waUrl, '_blank');
  }
</script>
{% endblock %}
